<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokyo Banana</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', sans-serif;
        }

        #map {
            height: 100vh;
            width: 100%;
        }

        .map-buttons {
            position: absolute;
            bottom: 25px;
            right: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;

        }

        .map-button,
        .center-police-button {
            background-color: white;
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-radius: 50px;
            padding: 5px;
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            color: #4285F4;
        }

        .map-button span,
        .center-police-button span {
            font-size: 24px;
        }

        .slide-up-panel {
            position: fixed;
            bottom: -100%;
            left: 0;
            width: 100%;
            background-color: white;
            transition: bottom 0.3s ease-out;
            z-index: 1001;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 20px;
            box-sizing: border-box;
        }

        .slide-up-panel.active {
            bottom: 0;
        }

        .close-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        #locationName {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }

        #locationAddress {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
        }

        .phone-container {
            display: flex;
            align-items: center;
            margin-top: 15px;
        }

        .phone-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            cursor: pointer;
        }

        #locationPhone {
            font-size: 18px;
            color: #4CAF50;
        }

        .google-maps-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .google-maps-button {
            background-color: #4285F4;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin-right: 10px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }

        .google-maps-text {
            font-size: 18px;
            color: #4285F4;
        }

        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24;
        }

        .leaflet-tooltip {
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            padding: 3px 6px;
            font-size: 12px;
            white-space: nowrap;
        }

        .leaflet-tooltip-right:before {
            border-right-color: rgba(255, 255, 255, 0.8);
        }

        @keyframes glowing {
            0% {
                box-shadow: 0 0 5px #2b92e9;
            }

            50% {
                box-shadow: 0 0 20px #2b92e9;
            }

            100% {
                box-shadow: 0 0 5px #2b92e9;
            }
        }

        .user-location-marker {
            border-radius: 50%;
            border: 3px solid #2b92e9;
            animation: glowing 1.5s infinite;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .popup-button {
            flex: 1;
            border: none;
            color: white;
            padding: 8px 12px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 3px;
            transition: background-color 0.3s;
        }

        .explore-maps-button {
            background-color: #4285F4;
        }

        .explore-maps-button:hover {
            background-color: #3367D6;
        }

        .copy-button {
            background-color: #4CAF50;
        }

        .copy-button:hover {
            background-color: #45a049;
        }

        .copy-message {
            display: none;
            color: #4CAF50;
            font-size: 12px;
            margin-top: 5px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div class="map-buttons">
        <button id="homeButton" class="map-button">
            <span class="material-symbols-outlined">home_pin</span>
        </button>
        <button id="switchBasemap" class="map-button">
            <span class="material-symbols-outlined">layers</span>
        </button>
        <button id="centerPoliceStation" class="center-police-button">
            <span class="material-symbols-outlined">local_police</span>
        </button>
    </div>
    <div class="slide-up-panel" id="slideUpPanel">
        <button class="close-panel" id="closePanel">&times;</button>
        <h2 id="locationName"></h2>
        <p id="locationAddress"></p>
        <div class="google-maps-container">
            <button class="google-maps-button" id="googleMapsButton">
                <span class="material-symbols-outlined">map</span>
            </button>
            <span class="google-maps-text">Google Maps</span>
        </div>
        <div class="phone-container">
            <button class="phone-button" id="phoneButton">
                <span class="material-symbols-outlined">call</span>
            </button>
            <span id="locationPhone"></span>
        </div>

    </div>
    <script>
        var map = L.map('map').setView([35.6761483, 139.7855743], 12);

        var cartoDB = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        });

        var esriImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        });

        cartoDB.addTo(map);

        var customIcon = L.icon({
            iconUrl: 'https://i.ibb.co/bWhk7NN/gps-shadow.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        var policeIcon = L.icon({
            iconUrl: 'https://i.ibb.co/27Tj7h7/icons8-police-96-1.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        var homeIcon = L.icon({
            iconUrl: 'https://i.ibb.co/YLh5fnb/icons8-home-96.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        var fireStationIcon = L.icon({
            iconUrl: 'https://i.ibb.co/brrNnBB/icons8-fire-station-96.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        var pharmacyIcon = L.icon({
            iconUrl: 'https://i.ibb.co/4ftGVmD/icons8-pharmacy-96.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        var clinicIcon = L.icon({
            iconUrl: 'https://i.ibb.co/PGMd8Cj/icons8-clinic-96-1.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        var convenienceStoreIcon = L.icon({
            iconUrl: 'https://i.ibb.co/x6tVXBM/icons8-grocery-store-96.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        var restaurantIcon = L.icon({
            iconUrl: 'https://i.ibb.co/6W6gCqJ/icons8-plate-96.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });


        var locations = [
            {
                name: "Kayabacho Sky Heights (茅場町スカイハイツ)",
                address: "〒104-0033 1-30 Shinkawa, Chuo-ku, Tokyo",
                phone: "+81335537889",
                coords: [35.6761483, 139.7855743],
                googleMapsLink: "https://www.google.com/maps/place/Kayabacho+Sky+Heights/@35.6761701,139.7830198,898m/data=!3m2!1e3!4b1!4m6!3m5!1s0x6018894289cc0e3f:0x1baf548c93cc5e5b!8m2!3d35.6761658!4d139.7855947!16s%2Fg%2F1tz75zbf?entry=ttu"
            },
            {
                name: "GLOBIS University (Main Campus)(グロービス経営大学院 東京校)",
                address: "〒102-0084 Tokyo, Chiyoda City, Nibancho, 5-1 Sumitomo Fudosan Kojimachi Bldg",
                coords: [35.6854057, 139.7343067],
                googleMapsLink: "https://www.google.com/maps/place/Graduate+School+of+Management,+GLOBIS+University/@35.6854028,139.7354054,287m/data=!3m3!1e3!4b1!5s0x60188c637c6b9451:0xa84b8ae5bd2e0543!4m6!3m5!1s0x60188c637954c8f7:0xf45136104fe98b59!8m2!3d35.6854014!4d139.7368816!16s%2Fm%2F0bhbx0c?entry=ttu"
            },
            {
                name: "GLOBIS University (Annex)",
                address: "102-0083 Tokyo, Chiyoda City, Kojimachi, 4 Chome−2−6, Sumitomo Fudosan Kojimachi First Bldg., 10F",
                coords: [35.6844805, 139.7359373],
                googleMapsLink: "https://www.google.com/maps/place/Graduate+School+of+Management,+GLOBIS+University/@35.6854028,139.7354054,287m/data=!3m3!1e3!4b1!5s0x60188c637c6b9451:0xa84b8ae5bd2e0543!4m6!3m5!1s0x60188c637954c8f7:0xf45136104fe98b59!8m2!3d35.6854014!4d139.7368816!16s%2Fm%2F0bhbx0c?entry=ttu"
            },
            {
                name: "Embassy of the Republic of the Philippines(フィリピン共和国大使館)",
                address: "5 Chome-15-5 Roppongi, Minato City, Tokyo 106-8537, Japan",
                phone: "+81355621600",
                coords: [35.6600849, 139.7329619],
                googleMapsLink: "https://www.google.com/maps/place/Embassy+of+the+Republic+of+the+Philippines/@35.6600849,139.7329619,899m/data=!3m2!1e3!4b1!4m6!3m5!1s0x60188b79ab546613:0x4ee8940a9c1dd529!8m2!3d35.6600806!4d139.7355368!16s%2Fg%2F11fqqfg2lw?entry=ttu"
            },
            {
                name: "Fukagawa Police Station Eidaibashi Of Social Safety Center (深川警察署 永代橋地域安全センター)",
                address: "1 Chome-1-19 Saga, Koto City, Tokyo 135-0031, Japan",
                phone: "+81336410110",
                coords: [35.676199, 139.7885336],
                googleMapsLink: "https://www.google.com/maps/place/Fukagawa+Police+Station+Eidaibashi+Of+Social+Safety+Center/@35.6766717,139.7786685,2277m/data=!3m1!1e3!4m10!1m2!2m1!1spolice+station!3m6!1s0x6018896a04595555:0x1e7f8a9d4aefa239!8m2!3d35.6762397!4d139.7886337!15sCg5wb2xpY2Ugc3RhdGlvbpIBCnBvbGljZV9ib3jgAQA!16s%2Fg%2F11cndb1pcg?entry=ttu"
            },
            {
                name: "Xross Office (クロスオフィス)",
                address: "Kotobuki Building 2F 1-11-1 Kita-Shinagawa, Shinagawa-Ku, Tokyo 140-0001",
                coords: [35.62443560644324, 139.74307929861658],
                googleMapsLink: "https://www.google.com/maps/place/Xross+Office/@35.6244356,139.7430793,15z/data=!4m5!3m4!1s0x0:0x0!8m2!3d35.6244356!4d139.7430793"
            },
            {
                name: "Chuo Police Station (警視庁 中央警察署)",
                address: "14-2 Nihonbashikabutocho, Chuo City, Tokyo 103-0026, Japan",
                phone: "+81356510110",
                coords: [35.6803977, 139.7768135],
                googleMapsLink: "https://www.google.com/maps/place/Chuo+Police+Station/@35.679903,139.7769114,315m/data=!3m1!1e3!4m6!3m5!1s0x60188959eeb1559d:0x1d10a8e0b632bbee!8m2!3d35.680382!4d139.7770641!16s%2Fg%2F120sp_5f?entry=ttu"
            },
            {
                name: "Kayabacho Police Box (中央警察署 茅場町交番)",
                address: "15-4 Nihonbashikabutocho, Chuo City, Tokyo 103-0026, Japan",
                phone: "+81356510110",
                coords: [35.6795722, 139.7771658],
                googleMapsLink: "https://www.google.com/maps/place/Kayabacho+Police+Box/@35.679596,139.7771331,315m/data=!3m1!1e3!4m6!3m5!1s0x601889599aae4571:0xcd641a27165b95f0!8m2!3d35.6795536!4d139.7773218!16s%2Fg%2F1ptvvj1dm?entry=ttu"
            },
            {
                name: "Takahashi Police Box (中央警察署 高橋交番)",
                address: "2 Chome-20-2 Shinkawa, Chuo City, Tokyo 104-0033, Japan",
                phone: "+81356510110",
                coords: [35.6746043, 139.7805646],
                googleMapsLink: "https://www.google.com/maps/place/Takahashi+Police+Box/@35.6745868,139.7805981,40m/data=!3m1!1e3!4m6!3m5!1s0x6018895d753b1f21:0x2d71061f86532f8!8m2!3d35.6745734!4d139.7806592!16s%2Fg%2F12m94gm24?entry=ttu"
            },
            {
                name: "Nihonbashi Fire Station (東京消防庁 日本橋消防署)",
                address: "Japan, 〒103-0026 Tokyo, Chuo City, Nihonbashikabutocho, 14−12 東京消防庁日本橋消防署",
                phone: "+81336660119",
                coords: [35.6800763, 139.7774564],
                googleMapsLink: "https://www.google.com/maps/place/Nihonbashi+Fire+Station/@35.6800487,139.7774042,72m/data=!3m1!1e3!4m6!3m5!1s0x601889598cf6052b:0x3f11a34bd87c1282!8m2!3d35.680122!4d139.777558!16s%2Fg%2F1tk8nl46?entry=ttu"
            },
            {
                name: "Shinkawachozai Pharmacy (新川調剤薬局)",
                address: "Japan, 〒104-0033 Tokyo, Chuo City, Shinkawa, 2 Chome−1−3 3F グランスクエア",
                phone: "+81335520630",
                coords: [35.6752868, 139.7825957],
                googleMapsLink: "https://www.google.com/maps/place/Shinkawachozai+Pharmacy/@35.6752836,139.7784578,618m/data=!3m1!1e3!4m11!1m3!2m2!1sdrug+store!6e6!3m6!1s0x6018895d4be77a2f:0x9a18ece5759b375c!8m2!3d35.6752821!4d139.7827794!15sCgpkcnVnIHN0b3JlkgEIcGhhcm1hY3ngAQA!16s%2Fg%2F1tdl6330?entry=ttu"
            },
            {
                name: "Echizenbori Drugstore",
                address: "Japan, 〒104-0033 Tokyo, Chuo City, Shinkawa, 2 Chome−18−4 八重洲マンション",
                coords: [35.674943939915245, 139.7818579322287],
                googleMapsLink: "https://www.google.com/maps/place/Echizenbori+Drugstore/@35.6749361,139.7816816,48m/data=!3m2!1e3!5s0x6018895d6af353bb:0x2e8da95e87cc9e9a!4m11!1m3!2m2!1sdrug+store!6e6!3m6!1s0x60188903226d51d1:0xea7d53358b894571!8m2!3d35.6749366!4d139.781859!15sCgpkcnVnIHN0b3JlWgwiCmRydWcgc3RvcmWSAQhwaGFybWFjeZoBJENoZERTVWhOTUc5blMwVkpRMEZuU1VSTE1uWjVibWgzUlJBQuABAA!16s%2Fg%2F11h_vxxxnh?entry=ttu"
            },

            {
                name: "Sugi Drug Shinkawa (スギドラッグ 新川一丁目店)",
                address: "Japan, 〒104-0033 Tokyo, Chuo City, Shinkawa, 1 Chome−17−25 東茅場町有楽ビル 1階",
                phone: "+81362228571",
                coords: [35.6783982, 139.7829326],
                googleMapsLink: "https://www.google.com/maps/place/Sugi+Drug/@35.6787005,139.7803804,501m/data=!3m2!1e3!5s0x601889434ddaf677:0x560df6f2670ab706!4m10!1m2!2m1!1sdrug+store!3m6!1s0x60188943520a2099:0x60cde68dec68f405!8m2!3d35.6784129!4d139.7832299!15sCgpkcnVnIHN0b3JlkgEJZHJ1Z3N0b3Jl4AEA!16s%2Fg%2F11b5pjkf76?entry=ttu"
            },
            {
                name: "Sugi Drug Hatchobori (スギドラッグ 八丁堀店)",
                address: "Japan, 〒104-0032 Tokyo, Chuo City, Hatchobori, 1 Chome−13−10 三神ビル 1階",
                phone: "+81352449821",
                coords: [35.6768353, 139.7781279],
                googleMapsLink: "https://www.google.com/maps/place/Sugi+Drug/@35.6768353,139.7781279,114m/data=!3m2!1e3!5s0x6018895c05e280b3:0x1d4eb65f1a7d9c67!4m10!1m2!2m1!1sdrug+store!3m6!1s0x6018895c042bf37f:0x222ec7d21fa3a7b6!8m2!3d35.6768228!4d139.7785865!15sCgpkcnVnIHN0b3JlkgEJZHJ1Z3N0b3Jl4AEA!16s%2Fg%2F11fxvxv_vz?entry=ttu"
            },
            {
                name: "Yaesugai Medical Clinic (八重洲街診療所)",
                address: "Japan, 〒103-0027 Tokyo, Chuo City, Nihonbashi, 2 Chome−2−20 日本橋仲通りビル 3階",
                phone: "+81332711828",
                coords: [35.6820984, 139.7715971],
                googleMapsLink: "https://www.google.com/maps/place/Yaesugai+Medical+Clinic/@35.6820984,139.7715971,17z/data=!3m1!4b1!4m6!3m5!1s0x60188958723e2a03:0xcc9eb1c50d358c48!8m2!3d35.6820984!4d139.7715971!16s%2Fg%2F1tg6pq9n?entry=ttu"
            },
            {
                name: "Nihonbashi Women's Clinic (日本橋ウィメンズクリニック)",
                address: "Japan, 〒103-0027 Tokyo, Chuo City, Nihonbashi, 2 Chome−1−21 第二東洋ビル 2F",
                phone: "+81352011555",
                coords: [35.6827122, 139.771743],
                googleMapsLink: "https://www.google.com/maps/place/Nihonbashi+Women's+Clinic/@35.6827122,139.771743,173m/data=!3m2!1e3!5s0x60188bfd8d2ea91f:0xe23baf251f65e9f5!4m10!1m2!2m1!1sClinic!3m6!1s0x60188bfd8d3aaaab:0x58f8a43271c3419f!8m2!3d35.6827233!4d139.7723565!15sCgZDbGluaWOSAQ5tZWRpY2FsX2NsaW5pY-ABAA!16s%2Fg%2F11cn9tq70y?entry=ttu"
            },
            {
                name: "Ministop Shinkawa 1-chome (ミニストップ 新川１丁目店)",
                address: "1 Chome-25-12 Shinkawa, Chuo City, Tokyo 104-0033, Japan",
                phone: "+81335233108",
                coords: [35.6762694, 139.7845467],
                googleMapsLink: "https://www.google.com/maps/place/Natural+Lawson/@35.6763915,139.7844315,235m/data=!3m2!1e3!5s0x60188942f15e3e39:0xf7b97433e7a37b79!4m14!1m7!3m6!1s0x6018894289cc0e3f:0x1baf548c93cc5e5b!2sKayabacho+Sky+Heights!8m2!3d35.6761658!4d139.7855947!16s%2Fg%2F1tz75zbf!3m5!1s0x60188942f16fb989:0xb328e91882aea49!8m2!3d35.6768144!4d139.7852001!16s%2Fg%2F1vcl3rf0?entry=ttu"
            },
            {
                name: "Natural Lawson (ナチュラルローソン 新川一丁目店)",
                address: "1 Chome-24-1 Shinkawa, Chuo City, Tokyo 104-0033, Japan",
                phone: "+81335235430",
                coords: [35.6768123, 139.7849786],
                googleMapsLink: "https://www.google.com/maps/place/Natural+Lawson/@35.6763915,139.7844315,235m/data=!3m2!1e3!5s0x60188942f15e3e39:0xf7b97433e7a37b79!4m14!1m7!3m6!1s0x6018894289cc0e3f:0x1baf548c93cc5e5b!2sKayabacho+Sky+Heights!8m2!3d35.6761658!4d139.7855947!16s%2Fg%2F1tz75zbf!3m5!1s0x60188942f16fb989:0xb328e91882aea49!8m2!3d35.6768144!4d139.7852001!16s%2Fg%2F1vcl3rf0?entry=ttu"
            },
            {
                name: "7-Eleven (セブン-イレブン 中央区新川１丁目店)",
                address: "1 Chome-21-5 Shinkawa, Chuo City, Tokyo 104-0033, Japan",
                phone: "+81335555868",
                coords: [35.6769623, 139.7856929],
                googleMapsLink: "https://www.google.com/maps/place/7-Eleven/@35.6769623,139.7856929,126m/data=!3m2!1e3!5s0x6018893bf7a3d399:0x3e99d29720846fdf!4m14!1m7!3m6!1s0x6018894289cc0e3f:0x1baf548c93cc5e5b!2sKayabacho+Sky+Heights!8m2!3d35.6761658!4d139.7855947!16s%2Fg%2F1tz75zbf!3m5!1s0x601889425eafe3e7:0x13c48c91302bec94!8m2!3d35.6769323!4d139.7859845!16s%2Fg%2F1tjjpbrg?entry=ttu"
            },

            {
                name: "Tsukemen Sumida (つけ麺隅田 新川店)",
                address: "1 Chome-31-4 Shinkawa, Chuo City, Tokyo 104-0033, Japan",
                phone: "+81355409711",
                coords: [35.6758793, 139.7861668],
                googleMapsLink: "https://www.google.com/maps/place/Tsukemen+Sumida/@35.6758793,139.7861668,17z/data=!3m1!4b1!4m6!3m5!1s0x601889425f9134c1:0x6f615321c30f97fc!8m2!3d35.6758793!4d139.7861668!16s%2Fg%2F1tg6vkm2"
            },
            {
                name: "Yoshino",
                address: "2 Chome-15-2 Shinkawa, Chuo City, Tokyo 104-0033, Japan",
                phone: "+81335538876",
                coords: [35.6753460619295, 139.78325230857487],
                googleMapsLink: "https://www.google.com/maps/place/Yoshino/@35.6752461,139.7822746,205m/data=!3m1!1e3!4m10!1m2!2m1!1sRestaurants!3m6!1s0x60188942b3680b27:0x823bb514916ac1cf!8m2!3d35.6752884!4d139.7831908!15sCgtSZXN0YXVyYW50c1oNIgtyZXN0YXVyYW50c5IBE3RvbmthdHN1X3Jlc3RhdXJhbnSaASNDaFpEU1VoTk1HOW5TMFZKUTBGblNVUlhhamt5YVVOUkVBReABAA!16s%2Fg%2F1tgz5glh?entry=ttu"
            },

            {
                name: "Tsukemen Sumida (つけ麺隅田 新川店)",
                address: "1 Chome-31-4 Shinkawa, Chuo City, Tokyo 104-0033, Japan",
                phone: "+81355409711",
                coords: [35.6758793, 139.7861668],
                googleMapsLink: "https://www.google.com/maps/place/Tsukemen+Sumida/@35.6758793,139.7861668,17z/data=!3m1!4b1!4m6!3m5!1s0x601889425f9134c1:0x6f615321c30f97fc!8m2!3d35.6758793!4d139.7861668!16s%2Fg%2F1tg6vkm2"
            },
            {
                name: "Yoshino",
                address: "2 Chome-15-2 Shinkawa, Chuo City, Tokyo 104-0033, Japan",
                phone: "+81335538876",
                coords: [35.6753460619295, 139.78325230857487],
                googleMapsLink: "https://www.google.com/maps/place/Yoshino/@35.6752461,139.7822746,205m/data=!3m1!1e3!4m10!1m2!2m1!1sRestaurants!3m6!1s0x60188942b3680b27:0x823bb514916ac1cf!8m2!3d35.6752884!4d139.7831908!15sCgtSZXN0YXVyYW50c1oNIgtyZXN0YXVyYW50c5IBE3RvbmthdHN1X3Jlc3RhdXJhbnSaASNDaFpEU1VoTk1HOW5TMFZKUTBGblNVUlhhamt5YVVOUkVBReABAA!16s%2Fg%2F1tgz5glh?entry=ttu"
            },
            {
                name: "Delhi Shinkawa (新川デリー)",
                address: "Japan, 〒104-0033 Tokyo, Chuo City, Shinkawa, 1 Chome−19−10 アルファスタイル茅場町 1階",
                phone: "+81332978922",
                coords: [35.67794691420887, 139.78506452457975],
                googleMapsLink: "https://www.google.com/maps/place/Delhi+Shinkawa/@35.6779396,139.7791681,901m/data=!3m1!1e3!4m10!1m2!2m1!1sRestaurants!3m6!1s0x60188942b46a7cd5:0xa27a1084f0f24efa!8m2!3d35.6779552!4d139.785076!15sCgtSZXN0YXVyYW50c1oNIgtyZXN0YXVyYW50c5IBEWluZGlhbl9yZXN0YXVyYW504AEA!16s%2Fg%2F1td7hqf5?entry=ttu"
            },
            {
                name: "PEACE COFFEE ROASTERS 新川店",
                address: "1 Chome-29-10 Shinkawa, Chuo City, Tokyo 104-0033, Japan",
                phone: "+81362283353",
                coords: [35.67588323183024, 139.7852323116086],
                googleMapsLink: "https://www.google.com/maps/place/PEACE+COFFEE+ROASTERS+%E6%96%B0%E5%B7%9D%E5%BA%97/@35.6758496,139.7851915,85m/data=!3m1!1e3!4m6!3m5!1s0x601889bf0d6fc033:0x73710cc6dfb0b595!8m2!3d35.6758602!4d139.7852339!16s%2Fg%2F11qh58l0jr?entry=ttu"
            },
            {
                name: "Medetai-ya",
                address: "Japan, 〒104-0033 Tokyo, Chuo City, Shinkawa, 1 Chome−21−8 石田ビル",
                phone: "+819032336844",
                coords: [35.676830276457736, 139.78613488283935],
                googleMapsLink: "https://www.google.com/maps/place/Medetai-ya/@35.6767224,139.7856747,87m/data=!3m2!1e3!5s0x601889426786ee93:0xe6913ecbdccefe25!4m6!3m5!1s0x6018894258cc88d1:0x4229f33c9d129a95!8m2!3d35.67681!4d139.7861418!16s%2Fg%2F11bbx0b_wm?entry=ttu"
            },
            {
                name: "DualY wine & tapas",
                address: "Japan, 〒104-0033 Tokyo, Chuo City, Shinkawa, 1 Chome−30−7 茅場町スカイハイツ",
                phone: "+81355420187",
                coords: [35.67622136787882, 139.7854632089664],
                googleMapsLink: "https://www.google.com/maps/place/DualY+wine+%26+tapas/@35.6761679,139.7852444,70m/data=!3m1!1e3!4m6!3m5!1s0x601889ee13d6df4b:0x28e3306dff488fb0!8m2!3d35.6762248!4d139.785463!16s%2Fg%2F11h7kvjmmt?entry=ttu"
            }

        ];



        map.fitBounds(locations.map(loc => loc.coords));

        // Basemap switcher
        var currentBasemap = cartoDB;
        document.getElementById('switchBasemap').addEventListener('click', function () {
            if (currentBasemap === cartoDB) {
                map.removeLayer(cartoDB);
                esriImagery.addTo(map);
                currentBasemap = esriImagery;
            } else {
                map.removeLayer(esriImagery);
                cartoDB.addTo(map);
                currentBasemap = cartoDB;
            }
        });

        // Home button
        document.getElementById('homeButton').addEventListener('click', function () {
            map.flyTo(locations[0].coords, 19, {
                duration: 1.5, // Animation duration in seconds
                easeLinearity: 0.25
            });
        });

        // Center Police Station button
        document.getElementById('centerPoliceStation').addEventListener('click', function () {
            map.flyTo([35.6803977, 139.7768135], 19, {
                duration: 1.5, // Animation duration in seconds
                easeLinearity: 0.25
            });  // Center on Chuo Police Station
        });

        // Slide-up panel functions
        function showSlideUpPanel(location) {
            document.getElementById('locationName').textContent = location.name;
            document.getElementById('locationAddress').textContent = location.address;
            var phoneElement = document.getElementById('locationPhone');
            var phoneButton = document.getElementById('phoneButton');
            var googleMapsButton = document.getElementById('googleMapsButton');

            if (location.phone) {
                phoneElement.textContent = location.phone;
                phoneButton.style.display = 'flex';
                phoneButton.onclick = function () {
                    window.location.href = 'tel:' + location.phone;
                };
            } else {
                phoneElement.textContent = 'Phone not available';
                phoneButton.style.display = 'none';
            }

            // Google Maps Button
            googleMapsButton.onclick = function () {
                window.open(location.googleMapsLink, '_blank');
            };

            document.getElementById('slideUpPanel').classList.add('active');
        }

        document.getElementById('closePanel').addEventListener('click', function () {
            document.getElementById('slideUpPanel').classList.remove('active');
        });



        //Markers
        locations.forEach(function (loc) {
            var icon;
            if (loc.name.toLowerCase().includes('police')) {
                icon = policeIcon;
            } else if (loc.name.toLowerCase().includes('kayabacho sky heights')) {
                icon = homeIcon;
            } else if (loc.name.toLowerCase().includes('fire station')) {
                icon = fireStationIcon;
            } else if (loc.name.toLowerCase().includes('pharmacy') || loc.name.toLowerCase().includes('drug')) {
                icon = pharmacyIcon;
            } else if (loc.name.toLowerCase().includes('clinic')) {
                icon = clinicIcon;
            } else if (loc.name.toLowerCase().includes('ministop') || 
                       loc.name.toLowerCase().includes('lawson') || 
                       loc.name.toLowerCase().includes('7-eleven')) {
                icon = convenienceStoreIcon;
            } else if (loc.name.toLowerCase().includes('restaurant') ||
                       loc.name.toLowerCase().includes('café') ||
                       loc.name.toLowerCase().includes('cafe') ||
                       loc.name.toLowerCase().includes('coffee') ||
                       loc.name.toLowerCase().includes('delhi') ||
                       loc.name.toLowerCase().includes('tsukemen') ||
                       loc.name.toLowerCase().includes('medetai-ya') ||
                       loc.name.toLowerCase().includes('dualy') ||
                       loc.name.toLowerCase().includes('yoshino')) {
                icon = restaurantIcon;
            } else {
                icon = customIcon;
            }

            var marker = L.marker(loc.coords, { icon: icon }).addTo(map);
            marker.on('click', function () {
                showSlideUpPanel(loc);
            });

            // Add a tooltip (label) to the marker, excluding Japanese names and adjusting position
            var labelText = loc.name.split('(')[0].trim();
            var tooltip = L.tooltip({
                permanent: true,
                direction: 'right',
                offset: [10, -20],
                className: 'leaflet-tooltip'
            }).setContent(labelText);

            // Function to show/hide tooltip based on zoom level
            function updateTooltipVisibility() {
                if (map.getZoom() >= 19) {
                    marker.bindTooltip(tooltip);
                    marker.openTooltip();
                } else {
                    marker.unbindTooltip();
                }
            }

            // Initial visibility check
            updateTooltipVisibility();

            // Update visibility on zoom
            map.on('zoomend', updateTooltipVisibility);
        });

        function createUserLocationMarker(latlng) {
            return L.circleMarker(latlng, {
                radius: 8,
                fillColor: "#2b92e9",
                color: "#fff",
                weight: 3,
                opacity: 1,
                fillOpacity: 0.8,
                className: 'user-location-marker'
            });
        }

        var isTrackingUser = false;
        var userLocationMarker = null;
        var watchId = null;

        function getAddressFromLatLng(lat, lon) {
            var url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`;

            return fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.display_name) {
                        return data.display_name;
                    } else {
                        return "Address not found";
                    }
                })
                .catch(error => {
                    console.error("Error fetching address:", error);
                    return "Error fetching address";
                });
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function () {
                console.log('Copying to clipboard was successful!');
                showCopyMessage();
            }, function (err) {
                console.error('Could not copy text: ', err);
            });
        }

        function showCopyMessage() {
            var messageElement = document.getElementById('copyMessage');
            messageElement.style.display = 'block';
            setTimeout(function () {
                messageElement.style.display = 'none';
            }, 2000); // Hide the message after 2 seconds
        }



        function openGoogleMaps(lat, lon) {
            var url = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
            window.open(url, '_blank');
        }

        function trackUserLocation() {
            if ("geolocation" in navigator) {
                isTrackingUser = !isTrackingUser; // Toggle tracking state
                updateTrackingButtonState();

                if (isTrackingUser) {
                    watchId = navigator.geolocation.watchPosition(function (position) {
                        var lat = position.coords.latitude;
                        var lon = position.coords.longitude;
                        var accuracy = position.coords.accuracy;

                        // Remove existing user location marker if it exists
                        if (userLocationMarker) {
                            map.removeLayer(userLocationMarker);
                        }

                        // Create and add new user location marker
                        userLocationMarker = createUserLocationMarker([lat, lon]).addTo(map);

                        // Fetch address and update popup
                        getAddressFromLatLng(lat, lon).then(address => {
                            var popupContent = `
                    <div>
                        <p>You are currently at:</p>
                        <p id="user-address">${address}</p>
                        <div class="button-container">
                            <button class="popup-button explore-maps-button" onclick="openGoogleMaps(${lat}, ${lon})">Google Maps</button>
                            <button class="popup-button copy-button" onclick="copyToClipboard(document.getElementById('user-address').textContent)">Copy Address</button>
                        </div>
                        <p id="copyMessage" class="copy-message">Address copied!</p>
                    </div>
                `;
                            userLocationMarker.bindPopup(popupContent).openPopup();
                        });

                        // Pan map to user's location
                        map.panTo([lat, lon]);

                    }, function (error) {
                        console.error("Error: " + error.message);
                        isTrackingUser = false;
                        updateTrackingButtonState();
                    }, {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    });
                } else {
                    // Stop tracking
                    if (watchId !== null) {
                        navigator.geolocation.clearWatch(watchId);
                        watchId = null;
                    }
                    if (userLocationMarker) {
                        map.removeLayer(userLocationMarker);
                        userLocationMarker = null;
                    }
                }
            } else {
                console.log("Geolocation is not supported by this browser.");
            }
        }

        // Modify the track location button to toggle tracking
        var trackLocationButton = L.control({ position: 'topleft' });
        trackLocationButton.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
            div.innerHTML = '<a href="#" id="trackLocationBtn" title="Track My Location" role="button" aria-label="Track My Location" onclick="trackUserLocation(); return false;"><span class="material-symbols-outlined" style="font-size: 20px; line-height: 30px;">my_location</span></a>';
            return div;
        };
        trackLocationButton.addTo(map);

        // Function to update button appearance based on tracking state
        function updateTrackingButtonState() {
            var button = document.getElementById('trackLocationBtn');
            if (isTrackingUser) {
                button.style.backgroundColor = '#4CAF50';
                button.querySelector('span').style.color = 'white';
            } else {
                button.style.backgroundColor = '';
                button.querySelector('span').style.color = '';
            }
        }

    </script>
</body>

</html>
